parameters:

services:
  happyr.translation.loader:
    class: Symfony\Component\Translation\Loader\XliffFileLoader
    tags:
      - { name: 'translation.loader', alias: 'xliff' }

  happyr.translation.dumper:
    class: Symfony\Component\Translation\Dumper\XliffFileDumper
    tags:
      - { name: 'translation.dumper', alias: 'xliff' }

  # Custom data_collector to use our own template
  happyr.translation.data_collector:
    class: Symfony\Component\Translation\DataCollector\TranslationDataCollector
    arguments: [ '@?translator.data_collector' ]
    tags:
      - { name: 'data_collector', template: "@HappyrTranslation/Profiler/translation", id: "translation", priority: 200 }

  happyr.translation.service.loco:
    class: Happyr\TranslationBundle\Service\Loco
    arguments:
      - '@happyr.translation.request_manager'
      - '@happyr.translation.filesystem'
      - ~

  happyr.translation.filesystem:
    class: Happyr\TranslationBundle\Translation\FilesystemUpdater
    arguments:
      - '@happyr.translation.loader'
      - '@happyr.translation.dumper'
      - ~
      - ~
    tags:
      - { name: kernel.event_listener, event: kernel.terminate, method: onTerminate, priority: -20 }
      - { name: kernel.event_listener, event: console.terminate, method: onTerminate, priority: -20 }


  happyr.translation.request_manager:
    class: Happyr\TranslationBundle\Http\RequestManager
    public: false
    calls:
      - [ setLogger, ["@?logger"] ]

